<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defne's Serpent</title>
    <style>
        :root {
            --sunset-pink: #FF6F91;
            --turquoise: #1BC8C8;
            --dark-bg: #1a1a2e;
            --glow: rgba(255, 111, 145, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, var(--dark-bg), #16213e);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--sunset-pink), var(--turquoise));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .scoreboard {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .score-item {
            font-size: 0.9rem;
            color: var(--turquoise);
        }

        .lives {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .heart {
            color: var(--sunset-pink);
            font-size: 1.2rem;
        }

        .game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #gameCanvas {
            border: 3px solid var(--sunset-pink);
            border-radius: 10px;
            box-shadow: 0 0 30px var(--glow);
            image-rendering: crisp-edges;
            image-rendering: pixelated;
        }

        .controls {
            display: none;
            margin-top: 20px;
            gap: 10px;
            flex-direction: column;
            align-items: center;
        }

        .dpad {
            display: grid;
            grid-template: 50px 50px 50px / 50px 50px 50px;
            gap: 5px;
        }

        .dpad-btn {
            background: rgba(27, 200, 200, 0.8);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .dpad-btn:active {
            background: rgba(255, 111, 145, 0.8);
        }

        .dpad-up { grid-area: 1 / 2 / 2 / 3; }
        .dpad-left { grid-area: 2 / 1 / 3 / 2; }
        .dpad-right { grid-area: 2 / 3 / 3 / 4; }
        .dpad-down { grid-area: 3 / 2 / 4 / 3; }

        .pause-btn {
            background: var(--sunset-pink);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 10px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--turquoise);
            color: white;
            padding: 15px;
            border-radius: 8px;
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 999;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes flash {
            0%, 100% { background: transparent; }
            50% { background: rgba(255, 111, 145, 0.3); }
        }

        .flash {
            animation: flash 0.5s ease-in-out;
        }

        @media (max-width: 480px) {
            .title { font-size: 2rem; }
            .scoreboard { gap: 10px; padding: 8px 15px; }
            .controls { display: flex; }
        }

        @media (pointer: coarse) {
            .controls { display: flex; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">Defne's Serpent</h1>
    </div>

    <div class="scoreboard">
        <div class="score-item">Score: <span id="score">0</span></div>
        <div class="score-item">Best: <span id="highScore">0</span></div>
        <div class="score-item">Speed: <span id="speed">6</span> fps</div>
        <div class="score-item">
            Lives: <span class="lives" id="lives"></span>
        </div>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        
        <div class="controls">
            <div class="dpad">
                <button class="dpad-btn dpad-up" data-dir="up">↑</button>
                <button class="dpad-btn dpad-left" data-dir="left">←</button>
                <button class="dpad-btn dpad-right" data-dir="right">→</button>
                <button class="dpad-btn dpad-down" data-dir="down">↓</button>
            </div>
            <button class="pause-btn" id="pauseBtn">❚❚ Pause</button>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            /**
             * Game configuration constants
             */
            const CONFIG = {
                GRID_SIZE: 20,
                BOARD_WIDTH: 600,
                BOARD_HEIGHT: 600,
                INITIAL_SPEED: 6,
                SPEED_INCREMENT: 1,
                HEARTS_PER_SPEED: 5,
                MAX_SPEED: 18,
                INITIAL_LIVES: 3,
                COLORS: {
                    SNAKE: '#1BC8C8',
                    FOOD: '#FF6F91',
                    BACKGROUND: '#1a1a2e'
                }
            };

            /**
             * Base64 encoded sound effects as data URIs
             */
            const SOUNDS = {
                EAT: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmsZByeC0/PVfSkDL3vK7OGVRwwOVKvp8bJqGgU+ltbyy3kpAy17yOzgk0ULDlOq5+99WDRY',
                HIT: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+K2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmsZByeC0/PVfSkDL3vK7OGVRwwOVKvp8bJqGgU+ltbyy3kpAy17yOzgk0ULDlOq5+99'
            };

            /**
             * Utility functions
             */
            const Utils = {
                /**
                 * Get random integer between min and max (inclusive)
                 */
                randomInt(min, max) {
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                },

                /**
                 * Check if two positions are equal
                 */
                positionsEqual(pos1, pos2) {
                    return pos1.x === pos2.x && pos1.y === pos2.y;
                }
            };

            /**
             * Snake class representing the player's serpent
             */
            class Snake {
                constructor() {
                    this.body = [{ x: 10, y: 10 }];
                    this.direction = { x: 1, y: 0 };
                    this.directionQueue = [];
                    this.growing = false;
                }

                /**
                 * Queue a direction change
                 */
                changeDirection(newDirection) {
                    if (this.directionQueue.length < 2) {
                        this.directionQueue.push(newDirection);
                    }
                }

                /**
                 * Move the snake forward
                 */
                move() {
                    // Process queued direction changes
                    if (this.directionQueue.length > 0) {
                        const newDir = this.directionQueue.shift();
                        // Prevent reverse direction
                        if (newDir.x !== -this.direction.x || newDir.y !== -this.direction.y) {
                            this.direction = newDir;
                        }
                    }

                    const head = { ...this.body[0] };
                    head.x += this.direction.x;
                    head.y += this.direction.y;
                    
                    this.body.unshift(head);

                    if (!this.growing) {
                        this.body.pop();
                    } else {
                        this.growing = false;
                    }
                }

                /**
                 * Make the snake grow on next move
                 */
                grow() {
                    this.growing = true;
                }

                /**
                 * Check if snake collides with itself
                 */
                checkSelfCollision() {
                    const head = this.body[0];
                    return this.body.slice(1).some(segment => 
                        Utils.positionsEqual(head, segment)
                    );
                }

                /**
                 * Check if snake hits wall
                 */
                checkWallCollision() {
                    const head = this.body[0];
                    const maxCoord = (CONFIG.BOARD_WIDTH / CONFIG.GRID_SIZE) - 1;
                    return head.x < 0 || head.x > maxCoord || 
                           head.y < 0 || head.y > maxCoord;
                }

                /**
                 * Draw the snake on canvas
                 */
                draw(ctx) {
                    ctx.fillStyle = CONFIG.COLORS.SNAKE;
                    this.body.forEach((segment, index) => {
                        const x = segment.x * CONFIG.GRID_SIZE;
                        const y = segment.y * CONFIG.GRID_SIZE;
                        
                        ctx.fillRect(x, y, CONFIG.GRID_SIZE, CONFIG.GRID_SIZE);
                        
                        // Add glow effect to head
                        if (index === 0) {
                            ctx.shadowColor = CONFIG.COLORS.SNAKE;
                            ctx.shadowBlur = 10;
                            ctx.fillRect(x, y, CONFIG.GRID_SIZE, CONFIG.GRID_SIZE);
                            ctx.shadowBlur = 0;
                        }
                    });
                }

                /**
                 * Reset snake to initial state
                 */
                reset() {
                    this.body = [{ x: 10, y: 10 }];
                    this.direction = { x: 1, y: 0 };
                    this.directionQueue = [];
                    this.growing = false;
                }
            }

            /**
             * Food class representing heart-shaped food items
             */
            class Food {
                constructor() {
                    this.position = this.generatePosition();
                    this.pulsePhase = 0;
                }

                /**
                 * Generate random position that doesn't overlap with snake
                 */
                generatePosition(snake = null) {
                    const maxCoord = (CONFIG.BOARD_WIDTH / CONFIG.GRID_SIZE) - 1;
                    let position;
                    
                    do {
                        position = {
                            x: Utils.randomInt(0, maxCoord),
                            y: Utils.randomInt(0, maxCoord)
                        };
                    } while (snake && snake.body.some(segment => 
                        Utils.positionsEqual(segment, position)
                    ));
                    
                    return position;
                }

                /**
                 * Regenerate food position
                 */
                regenerate(snake) {
                    this.position = this.generatePosition(snake);
                    this.pulsePhase = 0;
                }

                /**
                 * Draw pulsing heart-shaped food
                 */
                draw(ctx) {
                    this.pulsePhase += 0.1;
                    const pulse = 0.8 + 0.2 * Math.sin(this.pulsePhase);
                    
                    const x = this.position.x * CONFIG.GRID_SIZE;
                    const y = this.position.y * CONFIG.GRID_SIZE;
                    const size = CONFIG.GRID_SIZE * pulse;
                    const offset = (CONFIG.GRID_SIZE - size) / 2;
                    
                    ctx.fillStyle = CONFIG.COLORS.FOOD;
                    ctx.shadowColor = CONFIG.COLORS.FOOD;
                    ctx.shadowBlur = 15 * pulse;
                    
                    // Draw heart shape
                    ctx.beginPath();
                    const heartX = x + offset + size / 2;
                    const heartY = y + offset + size / 4;
                    const heartSize = size / 3;
                    
                    ctx.arc(heartX - heartSize/2, heartY, heartSize/2, Math.PI, 0, false);
                    ctx.arc(heartX + heartSize/2, heartY, heartSize/2, Math.PI, 0, false);
                    ctx.lineTo(heartX, heartY + heartSize);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.shadowBlur = 0;
                }
            }

            /**
             * Sound manager for game audio effects
             */
            class SoundManager {
                constructor() {
                    this.sounds = {};
                    this.loadSounds();
                }

                /**
                 * Load Base64 encoded sounds
                 */
                loadSounds() {
                    try {
                        Object.keys(SOUNDS).forEach(key => {
                            this.sounds[key] = new Audio(SOUNDS[key]);
                            this.sounds[key].volume = 0.3;
                        });
                    } catch (error) {
                        console.warn('Audio not supported in this browser');
                    }
                }

                /**
                 * Play a sound effect
                 */
                play(soundName) {
                    if (this.sounds[soundName]) {
                        this.sounds[soundName].currentTime = 0;
                        this.sounds[soundName].play().catch(() => {});
                    }
                }
            }

            /**
             * UI manager for toasts and confetti
             */
            class UIManager {
                /**
                 * Show encouraging toast message
                 */
                showToast(message) {
                    const existingToast = document.querySelector('.toast');
                    if (existingToast) {
                        existingToast.remove();
                    }

                    const toast = document.createElement('div');
                    toast.className = 'toast';
                    toast.textContent = message;
                    document.body.appendChild(toast);

                    setTimeout(() => toast.remove(), 3000);
                }

                /**
                 * Flash the canvas for collision feedback
                 */
                flashCanvas(canvas) {
                    canvas.classList.add('flash');
                    setTimeout(() => canvas.classList.remove('flash'), 500);
                }

                /**
                 * Show confetti celebration
                 */
                showConfetti() {
                    const canvas = document.createElement('canvas');
                    canvas.className = 'confetti';
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    document.body.appendChild(canvas);

                    const ctx = canvas.getContext('2d');
                    const particles = [];

                    // Create confetti particles
                    for (let i = 0; i < 50; i++) {
                        particles.push({
                            x: Math.random() * canvas.width,
                            y: -10,
                            vx: (Math.random() - 0.5) * 4,
                            vy: Math.random() * 3 + 1,
                            color: Math.random() > 0.5 ? '#FF6F91' : '#1BC8C8',
                            size: Math.random() * 8 + 4
                        });
                    }

                    const animate = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        
                        particles.forEach((particle, index) => {
                            particle.x += particle.vx;
                            particle.y += particle.vy;
                            particle.vy += 0.1; // gravity

                            ctx.fillStyle = particle.color;
                            ctx.fillRect(particle.x, particle.y, particle.size, particle.size);

                            if (particle.y > canvas.height + 50) {
                                particles.splice(index, 1);
                            }
                        });

                        if (particles.length > 0) {
                            requestAnimationFrame(animate);
                        } else {
                            canvas.remove();
                        }
                    };

                    animate();
                }

                /**
                 * Update lives display
                 */
                updateLives(lives) {
                    const livesElement = document.getElementById('lives');
                    livesElement.innerHTML = '';
                    for (let i = 0; i < lives; i++) {
                        const heart = document.createElement('span');
                        heart.className = 'heart';
                        heart.textContent = '♥';
                        livesElement.appendChild(heart);
                    }
                }
            }

            /**
             * Main Game class orchestrating all game mechanics
             */
            class Game {
                constructor() {
                    this.canvas = document.getElementById('gameCanvas');
                    this.ctx = this.canvas.getContext('2d');
                    this.snake = new Snake();
                    this.food = new Food();
                    this.soundManager = new SoundManager();
                    this.uiManager = new UIManager();
                    
                    this.score = 0;
                    this.highScore = parseInt(localStorage.getItem('defne-serpent-high-score') || '0');
                    this.speed = CONFIG.INITIAL_SPEED;
                    this.lives = CONFIG.INITIAL_LIVES;
                    this.isPaused = false;
                    this.gameRunning = true;
                    
                    this.lastTime = 0;
                    this.frameTime = 1000 / this.speed;
                    
                    this.encouragingMessages = [
                        "Way to grow, Defne!",
                        "You're doing amazing!",
                        "Keep it up, Defne!",
                        "Fantastic moves!",
                        "You're on fire!"
                    ];

                    this.initializeUI();
                    this.setupControls();
                    this.gameLoop();
                }

                /**
                 * Initialize UI elements
                 */
                initializeUI() {
                    document.getElementById('highScore').textContent = this.highScore;
                    this.uiManager.updateLives(this.lives);
                    this.updateUI();
                }

                /**
                 * Set up keyboard and touch controls
                 */
                setupControls() {
                    // Keyboard controls
                    document.addEventListener('keydown', (e) => {
                        if (!this.gameRunning) return;

                        switch(e.key) {
                            case 'ArrowUp':
                            case 'w':
                            case 'W':
                                e.preventDefault();
                                this.snake.changeDirection({ x: 0, y: -1 });
                                break;
                            case 'ArrowDown':
                            case 's':
                            case 'S':
                                e.preventDefault();
                                this.snake.changeDirection({ x: 0, y: 1 });
                                break;
                            case 'ArrowLeft':
                            case 'a':
                            case 'A':
                                e.preventDefault();
                                this.snake.changeDirection({ x: -1, y: 0 });
                                break;
                            case 'ArrowRight':
                            case 'd':
                            case 'D':
                                e.preventDefault();
                                this.snake.changeDirection({ x: 1, y: 0 });
                                break;
                            case ' ':
                            case 'p':
                            case 'P':
                                e.preventDefault();
                                this.togglePause();
                                break;
                        }
                    });

                    // Touch controls
                    const dpadButtons = document.querySelectorAll('.dpad-btn');
                    dpadButtons.forEach(button => {
                        button.addEventListener('pointerdown', (e) => {
                            e.preventDefault();
                            const direction = e.target.dataset.dir;
                            this.handleDirectionInput(direction);
                        });

                        button.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            const direction = e.target.dataset.dir;
                            this.handleDirectionInput(direction);
                        });
                    });

                    // Pause button
                    document.getElementById('pauseBtn').addEventListener('click', () => {
                        this.togglePause();
                    });
                }

                /**
                 * Handle direction input from touch controls
                 */
                handleDirectionInput(direction) {
                    if (!this.gameRunning) return;

                    const directions = {
                        'up': { x: 0, y: -1 },
                        'down': { x: 0, y: 1 },
                        'left': { x: -1, y: 0 },
                        'right': { x: 1, y: 0 }
                    };

                    if (directions[direction]) {
                        this.snake.changeDirection(directions[direction]);
                    }
                }

                /**
                 * Toggle game pause state
                 */
                togglePause() {
                    this.isPaused = !this.isPaused;
                    const pauseBtn = document.getElementById('pauseBtn');
                    pauseBtn.textContent = this.isPaused ? '► Resume' : '❚❚ Pause';
                }

                /**
                 * Update UI displays
                 */
                updateUI() {
                    document.getElementById('score').textContent = this.score;
                    document.getElementById('speed').textContent = this.speed;
                    
                    if (this.score > this.highScore) {
                        this.highScore = this.score;
                        document.getElementById('highScore').textContent = this.highScore;
                        localStorage.setItem('defne-serpent-high-score', this.highScore.toString());
                        
                        // Show celebration
                        this.uiManager.showToast("Defne, you nailed it! New high score!");
                        this.uiManager.showConfetti();
                    }
                }

                /**
                 * Handle food consumption
                 */
                eatFood() {
                    this.snake.grow();
                    this.score += 10;
                    this.food.regenerate(this.snake);
                    this.soundManager.play('EAT');
                    
                    // Show encouraging message
                    const message = this.encouragingMessages[
                        Math.floor(Math.random() * this.encouragingMessages.length)
                    ];
                    this.uiManager.showToast(message);

                    // Increase speed every 5 hearts
                    if (this.score % (CONFIG.HEARTS_PER_SPEED * 10) === 0 && 
                        this.speed < CONFIG.MAX_SPEED) {
                        this.speed += CONFIG.SPEED_INCREMENT;
                        this.frameTime = 1000 / this.speed;
                    }

                    this.updateUI();
                }

                /**
                 * Handle collision events
                 */
                handleCollision() {
                    this.lives--;
                    this.soundManager.play('HIT');
                    this.uiManager.flashCanvas(this.canvas);
                    this.uiManager.updateLives(this.lives);

                    if (this.lives <= 0) {
                        this.gameOver();
                    } else {
                        this.snake.reset();
                        this.uiManager.showToast(`Oops! ${this.lives} lives left`);
                    }
                }

                /**
                 * Handle game over
                 */
                gameOver() {
                    this.gameRunning = false;
                    setTimeout(() => {
                        if (confirm(`Game Over! Score: ${this.score}\nPlay again?`)) {
                            this.restart();
                        }
                    }, 500);
                }

                /**
                 * Restart the game
                 */
                restart() {
                    this.snake.reset();
                    this.food.regenerate(this.snake);
                    this.score = 0;
                    this.speed = CONFIG.INITIAL_SPEED;
                    this.lives = CONFIG.INITIAL_LIVES;
                    this.frameTime = 1000 / this.speed;
                    this.gameRunning = true;
                    this.isPaused = false;
                    
                    document.getElementById('pauseBtn').textContent = '❚❚ Pause';
                    this.uiManager.updateLives(this.lives);
                    this.updateUI();
                }

                /**
                 * Check for collisions
                 */
                checkCollisions() {
                    // Check food collision
                    if (Utils.positionsEqual(this.snake.body[0], this.food.position)) {
                        this.eatFood();
                    }

                    // Check wall or self collision
                    if (this.snake.checkWallCollision() || this.snake.checkSelfCollision()) {
                        this.handleCollision();
                    }
                }

                /**
                 * Render game frame
                 */
                render() {
                    // Clear canvas
                    this.ctx.fillStyle = CONFIG.COLORS.BACKGROUND;
                    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                    // Draw game elements
                    this.food.draw(this.ctx);
                    this.snake.draw(this.ctx);

                    // Draw pause overlay
                    if (this.isPaused) {
                        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                        this.ctx.fillStyle = 'white';
                        this.ctx.font = '48px Courier New';
                        this.ctx.textAlign = 'center';
                        this.ctx.fillText('PAUSED', this.canvas.width / 2, this.canvas.height / 2);
                    }
                }

                /**
                 * Main game loop using requestAnimationFrame with speed control
                 */
                gameLoop(currentTime = 0) {
                    const deltaTime = currentTime - this.lastTime;

                    if (deltaTime >= this.frameTime && this.gameRunning && !this.isPaused) {
                        this.snake.move();
                        this.checkCollisions();
                        this.lastTime = currentTime;
                    }

                    this.render();
                    requestAnimationFrame((time) => this.gameLoop(time));
                }
            }

            // Initialize game when DOM is loaded
            document.addEventListener('DOMContentLoaded', () => {
                new Game();
            });

        })();
    </script>
</body>
</html>
